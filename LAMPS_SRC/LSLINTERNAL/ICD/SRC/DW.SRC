	SUBROUTINE DW(CHAR)
C
	IMPLICIT CHARACTER*1 (A-Z)
C
C	Subroutine to draw character
C
C	Created					AJW	 2-Oct-1979
C
C	Copyright Laserscan Laboratories Ltd.,Cambridge,England.
C
	PARAMETER MAXMYSP=5
	PARAMETER X=1,Y=2
C
	INTEGER   CHAR		! character to be drawn
	LOGICAL   LINE		! do we draw line to cursor
	LOGICAL   CEND		! do we write cursor to end of char
	LOGICAL   HARD		! do we draw in stored mode
C
	INTEGER   I,MYSP
	INTEGER   STACK(2,MAXMYSP)
C
	INCLUDE 'CHRSTR.CMN'
C
C
	XLAST=0
	YLAST=0
	XMAX=-1000
C
	IF (CHAR.EQ.0) GOTO 130
C
	MYSP=1
	STACK(2,MYSP)=CHREF(1,CHAR)		! how far we've got
	STACK(1,MYSP)=CHREF(1,CHAR)+CHREF(2,CHAR)-1	! end
C
C anything to be done ?
10	IF (STACK(2,MYSP).GT.STACK(1,MYSP)) GOTO 70
C
	I=STACK(2,MYSP)
C call to primary ?
	  IF (STORE(3,I).EQ.4) GOTO 80
C
	  XLAST=XLAST+STORE(X,I)
	  YLAST=YLAST+STORE(Y,I)
	  XMAX =MAX(XMAX,ABS(XLAST))
C
C in primary ?
	  IF (MYSP.GT.1) GOTO 30
C no
	    IF (STORE(3,I).EQ.1) GOTO 20
	      GOTO 50
20	    CONTINUE
	      GOTO 50
C
C yes
30	  CONTINUE
	    IF (STORE(3,I).EQ.1) GOTO 40
	      GOTO 60
40	    CONTINUE
50	  CONTINUE
C
C
60	  STACK(2,MYSP)=STACK(2,MYSP)+1
	  GOTO 10
C
C end of char or primary
70	IF (MYSP.EQ.1) GOTO 130
	MYSP=MYSP-1
	STACK(2,MYSP)=STACK(2,MYSP)+1
	GOTO 10
C
C primary
80	MYSP=MYSP+1
	IF (MYSP.LE.MAXMYSP) GOTO 100
	  WRITE(5,90)
90	  FORMAT(' ','Primaries nested too deeply')
	  GOTO 130
100	I=STORE(1,I)
	IF ((I.GT.0).AND.(CHREF(1,I).GT.0)) GOTO 120
	  WRITE(5,110) I
110	  FORMAT(' ','No such Char/Primary ',I12)
	  GOTO 130
120	STACK(2,MYSP)=CHREF(1,I)
	STACK(1,MYSP)=CHREF(1,I)+CHREF(2,I)-1
	GOTO 10
C
130	CONTINUE
	RETURN
	END
