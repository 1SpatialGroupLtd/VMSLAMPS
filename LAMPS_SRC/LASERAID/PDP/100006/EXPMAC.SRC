	INTEGER FUNCTION EXPMAC (N, BUF)
C
C Copyright Laser-Scan Laboratories Ltd,Cambridge,England
C
C Author M.C.Fulford
C
C	Created 23.v.78
C	Last edited 24/v/78
C
C To expand a macro into text, returning number of chars

***	COMMON/PARAMS/

	INTEGER N	! macro number
	BYTE BUF(1)	! text buffer

***	COMMON/SCOTS/

	INTEGER P	! macro pointer
	INTEGER B	! text  pointer

	INTEGER EXPAND	! function

	P = MACPTR(N)-1
	B = 0

10	P = P+1
	IF (MCNAME(P) .EQ. 0) GOTO 30
	  B = B+EXPAND('%W %5',BUF(B+1),MCNAME(P))
	  B = B+1
15	  B = B-1	! remove trailing spaces
	  IF (BUF(B) .EQ. "40) GOTO 15
	  IF ((MCCODE(P).AND."100000) .EQ. 0) GOTO 10
	  B = B+EXPAND('%W%N',BUF(B+1),MCNUMB(P))
	  GOTO 10

30	EXPMAC = B
	RETURN
	END
