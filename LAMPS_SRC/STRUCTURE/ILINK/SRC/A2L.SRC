	SUBROUTINE A2L(PT,NXT,PRV,FTR_PTS,MAXPTS,MAXOUTFTRS)

***	IDENT	12OC92
***	MODULE	A2L

C	Copyright : Laser-Scan Ltd., Cambridge, England
C	Created   : ACM					Month 1986

	IMPLICIT NONE

	INCLUDE		'LSL$CMNILINK:ILINK.CMN'

C Data in
	INTEGER*4	MAXPTS,MAXOUTFTRS
	INTEGER*4	NXT(MAXPTS)
	INTEGER*4	PRV(MAXPTS)
	INTEGER*4	FTR_PTS(2,MAXOUTFTRS)

	REAL*4		PT(2,MAXPTS)

C Workspace
	INTEGER*4	I,I_PR_FTR		! processed-ftr index
	INTEGER*4	IPTSTA,IPTFIN		! end pt PT indices
	LOGICAL  	CLOSED			! closed loop?
	REAL*4		DX,DY
	REAL*4		SQTOL,SQLEN

CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C
C	Converts from contiguous-array to linked-list representation
C	for FTR_PTS
C
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC

	SQTOL = COORD_TOL*COORD_TOL

	DO 10 I_PR_FTR = 1,N_PR_FTRS

	  IPTSTA = FTR_PTS(1,I_PR_FTR)
	  IPTFIN = FTR_PTS(2,I_PR_FTR)

	  IF (IPTSTA.EQ.IPTFIN) GOTO 10		! pt ftr

	  DX = PT(1,IPTSTA)-PT(1,IPTFIN)
	  DY = PT(2,IPTSTA)-PT(2,IPTFIN)
	  SQLEN = DX*DX+DY*DY
	  CLOSED = SQLEN.LT.SQTOL

	  IF (CLOSED) THEN
	    I = PRV(IPTFIN)
	    PRV(IPTFIN) = -1			! mark as deleted
	    IPTFIN = I
	    FTR_PTS(2,I_PR_FTR) = IPTFIN
	    IF (IPTSTA.NE.IPTFIN) THEN
	      NXT(IPTFIN) = IPTSTA
	      PRV(IPTSTA) = IPTFIN
	    ELSE				! become pt ftr
	      NXT(IPTSTA) = NIL
	    END IF
	  END IF

10	CONTINUE

	END

