	LOGICAL FUNCTION RD2MKS
C
***	IDENT	18MY88
***	MODULE	RD2MKS
C
C	Copyright LaserScan Laboratories Ltd., Cambridge, England
C
C Author TJ Ibbs, 16 March 1983
C
C This routine attempts to read the closing tapemarks of a DFAD tape,
C returns TRUE if it fails, else FALSE
C
	IMPLICIT NONE
C
C
C common blocks
C
***     PARAMETER/LSL$CMNLSL:LSLLIBMSG/
***	COMMON/LSL$CMNDLMS:DFAD/	! for buffer
***	COMMON/LSL$CMNLSL:MTIVCM  /	! magtape common
***	COMMON/HERE:PARAMS/     	! for DIAG_BRIEF
C
C functions called
C
	INTEGER		MTIRDB		! read a block off magtape
C
C workspace
C
	INTEGER*4	RETVAL		! result from MTIRDB, etc
	INTEGER*4	IERR		! for widening errors into
	INTEGER		I		! DO loop counter
C
C
C be prepared for the worst
C
	RD2MKS = .TRUE.
C
	DO 200 I = 1,2
	   IF (I.EQ.1) THEN
	      CALL EXPAND('*** Error reading first tape mark')
	   ELSE
	      CALL EXPAND('*** Error reading second tape mark')
	   ENDIF
C
C	 now do the actual read
C
	   RETVAL = MTIRDB( BYTBUF, INLEN, BYTCNT )
C
	   IF (.NOT. RETVAL) THEN          !error
	      IF (RETVAL.EQ.LSL__EOF)GOTO 200
	      CALL TTWLIN
	      CALL WRITEF('    block number is %N', MTINBL)
	      CALL LSL_PUTMSG(RETVAL)      !output error msg
	      IERR = MTIERR
	      IF (RETVAL.EQ.LSL__SYSERR)CALL LSL_PUTMSG(IERR)
	      GOTO 999
C
	   ELSE
	      CALL TTWLIN
	      CALL WRITEF ('    block %N contains %N stripes',
     &                            MTINBL,        BYTCNT )
	      GOTO 999
	   ENDIF
C
200	CONTINUE
C
C all went OK
C
C	IF ( DIAG_BRIEF ) THEN
C	   CALL WRITEF('Read the final two tapemarks')
C	ENDIF
	RD2MKS = .FALSE.
C
999	RETURN
	END

