	SUBROUTINE ASC(IN,OUT,NUM)
C
***	MODULE	ASC
***	IDENT	29JL87
C
	IMPLICIT NONE
C
C	Copyright Laser-Scan Laboratories Ltd., Cambridge, England
C
C	See .UPD file for further updates	RJH	29-Jul-1987
C	Bit 0 is most significant	AJW		19-Mar-1981
C	Created				AJW		11-Mar-1981
C
C	IN is an array of 24 bit words
C	(well - 32 bit long words really)
C	ASC converts NUM 6 bit ICL chracters into ASCII in OUT
C
	INTEGER*2	NUM
	INTEGER*4	IN(*)
	BYTE		OUT(*)
C
	INTEGER*4	LIB$EXTZV
C
	INTEGER*4	I,CH,POS,WORD,NZERO,NBLANK
C
	NZERO = 0
	NBLANK = 0
	DO 20 I=1,NUM
	  POS=18-MOD(I-1,4)*6
	  WORD=(I-1)/4+1
	  CH=LIB$EXTZV(POS,6,IN(WORD))
	  IF (CH.EQ.0) NZERO = NZERO + 1
	  IF ((CH.AND."40).EQ.0) GOTO 10
	    CH=CH.XOR."140
	    GOTO 15
10	  CONTINUE
	    CH=CH.XOR."60
15	  IF (CH.EQ."137) CH="15	! underline
	  OUT(I)=CH
	  IF (CH.EQ.32) NBLANK = NBLANK+1
	  IF (CH.NE.32) NBLANK = 0
20	CONTINUE
C if all zeros then assume all spaces
	IF (NZERO.EQ.NUM) NBLANK = NUM
C terminate at last non-blank if longer than 20 chrs
C	IF (NUM.LT.20) NBLANK = 0
C	WRITE(5,66) 'NUM= ',NUM,'OUT(1)= ',OUT(1)
C This apparently redundant loop is to cure a problem with FLAG1 only being set
C to NULL when all the FLAGS from MHFLAG should be NULL
	DO 50 I = NUM+1-NBLANK, NUM
	  OUT(I)=32
50	CONTINUE
C66	FORMAT (A10,I4,A10,I4)
C
	IF (NUM.LT.80) OUT(NUM+1) = 0
C
	RETURN
	END
